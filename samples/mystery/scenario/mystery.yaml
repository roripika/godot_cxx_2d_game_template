start_scene: "prologue"

scenes:
  prologue:
    mode: "investigation"
    scene_path: "res://samples/mystery/office_base.tscn"
    on_enter:
      - dialogue: { speaker_key: "speaker.system", speaker: "System", text_key: "mystery.prologue.system" }
      - dialogue: { speaker_key: "speaker.detective", speaker: "Detective", text_key: "mystery.prologue.detective_intro" }
      - dialogue: { speaker_key: "speaker.boss", speaker: "Boss", text_key: "mystery.prologue.boss_call" }
      - dialogue: { speaker_key: "speaker.detective", speaker: "Detective", text_key: "mystery.prologue.detective_ack" }
      - goto:
          scene_id: "warehouse_investigation"
          fade_duration: 1.0

  warehouse_investigation:
    mode: "investigation"
    scene_path: "res://samples/mystery/warehouse_base.tscn"
    on_enter:
      - dialogue: { speaker_key: "speaker.detective", speaker: "Detective", text_key: "mystery.warehouse.intro" }

    hotspots:
      ectoplasm_spot:
        node_id: "hs_floor_area"
        on_click:
          - if_has_items:
              items: ["ectoplasm"]
              then:
                - dialogue: { speaker_key: "speaker.detective", speaker: "Detective", text_key: "mystery.warehouse.ecto.already" }
              else:
                - dialogue: { speaker_key: "speaker.detective", speaker: "Detective", text_key: "mystery.warehouse.ecto.inspect" }
                - dialogue: { speaker_key: "speaker.system", speaker: "System", text_key: "mystery.warehouse.ecto.found" }
                - give_evidence: "ectoplasm"
                - set_flag: { key: "found_ecto", value: true }

      footprint_spot:
        node_id: "hs_footprints"
        on_click:
          - dialogue: { speaker_key: "speaker.detective", speaker: "Detective", text_key: "mystery.warehouse.footprint.observe" }
          - if_flag:
              key: "found_footprint"
              value: true
              then:
                - dialogue: { speaker_key: "speaker.detective", speaker: "Detective", text_key: "mystery.warehouse.footprint.detail" }
              else:
                - dialogue: { speaker_key: "speaker.system", speaker: "System", text_key: "mystery.warehouse.footprint.found" }
                - give_evidence: "footprint"
                - set_flag: { key: "found_footprint", value: true }

      memo_spot:
        node_id: "hs_memo"
        on_click:
          - dialogue: { speaker_key: "speaker.detective", speaker: "Detective", text_key: "mystery.warehouse.memo.observe" }
          - choice:
              choices:
                - option:
                    text_key: "mystery.choice.pick_up"
                    actions:
                      - give_evidence: "torn_memo"
                      - dialogue: { speaker_key: "speaker.system", speaker: "System", text_key: "mystery.warehouse.memo.found" }
                - option:
                    text_key: "mystery.choice.leave"
                    actions:
                      - dialogue: { speaker_key: "speaker.detective", speaker: "Detective", text_key: "mystery.warehouse.memo.leave" }

      exit_spot:
        node_id: "hs_exit"
        on_click:
          - if_has_items:
              items: ["ectoplasm", "footprint", "torn_memo"]
              then:
                - dialogue: { speaker_key: "speaker.detective", speaker: "Detective", text_key: "mystery.warehouse.exit.ready" }
                - dialogue: { speaker_key: "speaker.detective", speaker: "Detective", text_key: "mystery.warehouse.exit.return" }
                - goto:
                    scene_id: "deduction"
                    fade_duration: 1.0
              else:
                - dialogue: { speaker_key: "speaker.detective", speaker: "Detective", text_key: "mystery.warehouse.exit.not_ready" }

  deduction:
    mode: "deduction"
    scene_path: "res://samples/mystery/office_base.tscn"
    on_enter:
      - dialogue: { speaker_key: "speaker.boss", speaker: "Boss", text_key: "mystery.deduction.question" }
      - choice:
          choices:
            - option:
                text_key: "mystery.deduction.choice.ghost"
                actions:
                  - dialogue: { speaker_key: "speaker.boss", speaker: "Boss", text_key: "mystery.deduction.ghost.response1" }
                  - dialogue: { speaker_key: "speaker.detective", speaker: "Detective", text_key: "mystery.deduction.ghost.response2" }
                  - goto:
                      scene_id: "confrontation"
                      fade_duration: 1.0
            - option:
                text_key: "mystery.deduction.choice.human"
                actions:
                  - dialogue: { speaker_key: "speaker.boss", speaker: "Boss", text_key: "mystery.deduction.human.wrong1" }
                  - take_damage: 1
                  - if_health_leq:
                      value: 0
                      then:
                        - set_flag: { key: "game_over", value: true }
                        - goto:
                            scene_id: "ending_bad"
                            fade_duration: 2.0
                      else:
                        - dialogue: { speaker_key: "speaker.boss", speaker: "Boss", text_key: "mystery.deduction.human.retry" }
                        - goto: "deduction"
            - option:
                text_key: "mystery.deduction.choice.alien"
                actions:
                  - dialogue: { speaker_key: "speaker.boss", speaker: "Boss", text_key: "mystery.deduction.alien.wrong1" }
                  - take_damage: 1
                  - if_health_leq:
                      value: 0
                      then:
                        - set_flag: { key: "game_over", value: true }
                        - goto:
                            scene_id: "ending_bad"
                            fade_duration: 2.0
                      else:
                        - dialogue: { speaker_key: "speaker.boss", speaker: "Boss", text_key: "mystery.deduction.alien.retry" }
                        - goto: "deduction"

  confrontation:
    mode: "confrontation"
    scene_path: "res://samples/mystery/warehouse_base.tscn"
    on_enter:
      - dialogue: { speaker_key: "speaker.detective", speaker: "Detective", text_key: "mystery.confrontation.start1" }
      - dialogue: { speaker_key: "speaker.rat_witness", speaker: "Rat Witness", text_key: "mystery.confrontation.start2" }
      - testimony:
          max_rounds: 3
          testimonies:
            -
              speaker_key: "speaker.rat_witness"
              speaker: "Rat Witness"
              text_key: "mystery.testimony.line1"
              shake_key: "mystery.testimony.line1.shake"
            -
              speaker_key: "speaker.rat_witness"
              speaker: "Rat Witness"
              text_key: "mystery.testimony.line2"
              evidence: "footprint"
              shake_key: "mystery.testimony.line2.shake"
            -
              speaker_key: "speaker.rat_witness"
              speaker: "Rat Witness"
              text_key: "mystery.testimony.line3"
              evidence: "torn_memo"
              shake_key: "mystery.testimony.line3.shake"
          on_success:
            - dialogue: { speaker_key: "speaker.rat_witness", speaker: "Rat Witness", text_key: "mystery.confrontation.success" }
            - goto:
                scene_id: "ending_good"
                fade_duration: 1.5
          on_failure:
            - dialogue: { speaker_key: "speaker.rat_witness", speaker: "Rat Witness", text_key: "mystery.confrontation.failure" }
            - goto:
                scene_id: "ending_bad"
                fade_duration: 2.0

  ending_good:
    mode: "ending"
    scene_path: "res://samples/mystery/ending_base.tscn"
    on_enter:
      - dialogue: { speaker_key: "speaker.system", speaker: "System", text_key: "mystery.ending.good1" }
      - dialogue: { speaker_key: "speaker.boss", speaker: "Boss", text_key: "mystery.ending.good2" }
      - dialogue: { speaker_key: "speaker.system", speaker: "System", text_key: "mystery.ending.good3" }

  ending_bad:
    mode: "ending"
    scene_path: "res://samples/mystery/ending_base.tscn"
    on_enter:
      - dialogue: { speaker_key: "speaker.system", speaker: "System", text_key: "mystery.ending.bad1" }
      - dialogue: { speaker_key: "speaker.boss", speaker: "Boss", text_key: "mystery.ending.bad2" }
      - dialogue: { speaker_key: "speaker.system", speaker: "System", text_key: "mystery.ending.bad3" }
