# UI レイアウト共通ポリシー（全ゲーム適用）

## 1. 適用範囲
- 本ポリシーは、このリポジトリ配下の **全デモ/全ゲーム UI** に適用する。
- デモ固有の追加ルールは、各デモの拡張ポリシーで定義してよい。
  - 例: Mystery は `docs/mystery_ui_layout_policy.md`

## 2. 基本ルール（必須）
- UI は同じ画面内で内容物ごとにグループ分けする。
- 同一グループ内で UI を重ねない（同一グループ内の重なりは設計違反）。
- アクション/タップにより、別グループ UI が一時的に上へ重なることは許可する。
- グループごとの優先順位は固定する。
- 子グループ（サブ階層）を定義して運用してよい。
- エフェクト UI は「発生文脈」によって優先順位を変更できる。
- グループ/子グループ/各パーツの階層設計はドキュメント台帳で管理する。

## 3. グループ優先順位（上が前面）
1. システムUIグループ
2. インスタントサブ情報UIグループ
3. メイン情報UIグループ
4. サブ情報UIグループ

Godot 実装では、原則として `CanvasLayer.layer` または `z_index` で表現する。

## 4. グループ定義（共通）
### 4.1 システムUIグループ（最前面）
- 役割: ゲーム進行に依存しない常設操作/状態表示。
- 例: 言語切替、戻る、HP、デバッグ表示、全体ガイド。

### 4.2 インスタントサブ情報UIグループ
- 役割: 短時間で消える補助情報。
- 例: トースト、ヒント、即時警告、短時間オーバーレイ。

### 4.3 メイン情報UIグループ
- 役割: 進行の主文脈を担う UI。
- 例: 会話、戦闘HUD、譜面UI、主要操作パネル。

### 4.4 サブ情報UIグループ（最背面）
- 役割: 参照系の補助情報。
- 例: インベントリ、詳細パネル、ヘルプ、ログ。

## 5. 子グループ運用
- 各グループに子グループを置いてよい。
- 子グループ内でも「重なり禁止」を守る。
- 子グループは「領域分割（アンカー）」で干渉を避ける。

## 6. エフェクトUIの優先順位ルール
- 通常の視覚強調（点滅/ハイライト）:
  - 親 UI と同一グループ内で一段上に表示する。
- 注意喚起（警告/失敗通知）:
  - インスタントサブ情報UIへ昇格表示する。
- 画面遷移/フェードなど全画面制御:
  - 一時的にシステムUIより上に表示してよい。
  - 終了後は必ず破棄し、常設しない。

## 7. アンカー設計ルール
- 主要 UI は固定座標ではなくアンカー比率で配置する。
- グループごとに担当矩形を決め、同一グループ内で矩形を共有しない。
- `project.godot` のストレッチ設定とセットで管理する。
- デモごとに「基準解像度 + 検証解像度」を設計書で明示する。

## 8. 階層設計台帳（管理フォーマット）
以下を UI 変更PRごとに更新する。

| group | child_group | node_path | scene | layer/z | anchor_rect | overlap_in_group | owner |
|---|---|---|---|---|---|---|---|
| system | system.top_left | `CanvasLayer/HealthBar` | `res://...` | system | x0.02-0.28, y0.02-0.10 | no | designer |
| main | main.bottom | `CanvasLayer/MainHud` | `res://...` | main | x0.30-0.98, y0.64-0.98 | no | designer |

## 9. レビュー観点（UI共通）
- 同一グループ内で重なりが発生していない。
- グループ優先順位が崩れていない。
- 一時表示 UI が表示後に適切に閉じる。
- 新規 UI パーツが台帳に追記されている。

## 10. 運用
- 本ポリシーを UI 設計の一次情報とする。
- デモ固有仕様は本ポリシーを上書きせず、拡張のみ許可する。
- 例外を入れる場合は、PR本文に理由と影響範囲を明記する。
